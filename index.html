<!DOCTYPE html>
<html>
<head>
    <title>Biomedical Waste Segregation Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        #welcomeScreen, #gameScreen, #gameOverScreen {
            padding: 40px 20px;
        }

        #gameScreen, #gameOverScreen {
            display: none;
        }

        .bin {
            display: inline-block;
            width: 130px;
            margin: 10px;
            cursor: pointer;
        }

        #itemImage {
            width: 220px;
            height: 220px;
            margin: 20px;
            object-fit: contain;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        #scoreDisplay, #timerDisplay, #difficultyDisplay {
            font-size: 20px;
            margin-top: 8px;
        }

        .difficulty-buttons button {
            padding: 12px 22px;
            margin: 10px;
            font-size: 18px;
            cursor: pointer;
        }

        ul {
            padding-left: 0;
        }

        ul li {
            list-style-type: disc;
            margin-left: 20px;
            text-align: left;
        }
    </style>
</head>

<body>

<!-- ‚≠ê WELCOME SCREEN ‚≠ê -->
<div id="welcomeScreen">
    <h1>Biomedical Waste Segregation Game</h1>
    <p style="font-size:18px; max-width:650px; margin:auto;">
        Learn correct biomedical waste disposal by selecting the right bin for each item.
        Choose a difficulty level based on your role and experience.
    </p>

    <h3>How to Play</h3>
    <ul style="display:inline-block; font-size:17px; line-height:1.6; max-width:650px;">
        <li>An item appears on the screen.</li>
        <li>Click the correct bin to dispose of it.</li>
        <li>Correct answers = <b>+1 point</b>.</li>
        <li>Wrong answers or no answer in time (Medium/Hard) = <b>-1 point</b>.</li>
        <li>You have limited time to score maximum points.</li>
    </ul>

    <h3>Select Difficulty</h3>
    <div class="difficulty-buttons">
        <button onclick="startGame('easy')">Easy</button>
        <button onclick="startGame('medium')">Medium</button>
        <button onclick="startGame('hard')">Hard</button>
    </div>

    <p style="margin-top:20px; font-size:14px;">
        Easy: Beginners / Housekeeping ‚Ä¢ Medium: Regular Staff ‚Ä¢ Hard: Experienced Staff / Competition<br>
        (Certificate download will be added soon.)
    </p>
</div>


<!-- ‚≠ê GAME SCREEN ‚≠ê -->
<div id="gameScreen">
    <h2>Choose the Correct Bin</h2>

    <div id="difficultyDisplay"></div>
    <div id="timerDisplay">Time Left: 60s</div>
    <div id="scoreDisplay">Score: 0</div>

    <img id="itemImage" src="" alt="Item">

    <div id="binsContainer">
        <!-- bin images from /images folder -->
        <img src="images/redbin.jpg"          class="bin" onclick="checkAnswer('red')"          alt="Red Bin">
        <img src="images/yellowbin.jpg"       class="bin" onclick="checkAnswer('yellow')"       alt="Yellow Bin">
        <img src="images/bluebin.png"         class="bin" onclick="checkAnswer('blue')"         alt="Blue Bin">
        <img src="images/greenbin.png"        class="bin" onclick="checkAnswer('green')"        alt="Green Bin">
        <img src="images/translucentbin.png"  class="bin" onclick="checkAnswer('translucent')"  alt="Translucent (Sharps) Bin">
    </div>
</div>


<!-- ‚≠ê GAME OVER SCREEN ‚≠ê -->
<div id="gameOverScreen">
    <h1>Game Over!</h1>
    <h2>Your Score: <span id="finalScore"></span></h2>
    <p id="finalDifficultyText"></p>

    <button onclick="backToWelcome()"
            style="padding:15px 30px; font-size:20px; margin-top:20px; cursor:pointer;">
        Play Again (Choose Level)
    </button>

    <p style="margin-top:30px;">Certificate feature will be added soon.</p>
</div>


<script>
    // ‚≠ê DIFFICULTY SETTINGS ‚≠ê
    const difficultySettings = {
        easy: {
            label: "Easy (90s, no penalty for slow response)",
            totalTime: 90,          // seconds
            autoSkipMs: null,       // no forced skip
            itemPool: "easy"
        },
        medium: {
            label: "Medium (60s, 5s per item)",
            totalTime: 60,
            autoSkipMs: 5000,       // 5 seconds per item
            itemPool: "all"
        },
        hard: {
            label: "Hard (30s, 3s per item, trickier items included)",
            totalTime: 30,
            autoSkipMs: 3000,       // 3 seconds per item
            itemPool: "allPlusTricky"
        }
    };

    // ‚≠ê ITEM POOLS (filenames from your /images folder) ‚≠ê
    // Bins used:
    // red         = contaminated plastics
    // yellow      = anatomical / soiled / blood bags
    // blue        = glass & implants
    // green       = general / medicines (for game purposes)
    // translucent = sharps (white bin equivalent)

    const easyItems = [
        { name: "Mask",                   bin: "red",         img: "images/Mask.webp" },
        { name: "Syringe (no needle)",    bin: "red",         img: "images/Syringe.webp" },
        { name: "Blood Bag",              bin: "yellow",      img: "images/Blood Bag.avif" },
        { name: "Cotton / Swabs",         bin: "yellow",      img: "images/Contaminated-Cotton-Swabs.webp" },
        { name: "Vial",                   bin: "blue",        img: "images/Vial.jpg" },
        { name: "Ampoules",               bin: "blue",        img: "images/Ampoules.webp" },
        { name: "Expired Medicines",      bin: "green",       img: "images/Expired Medicines.webp" }
    ];

    const mediumExtraItems = [
        { name: "IV Set",                 bin: "red",         img: "images/IV SET.png" },
        { name: "Catheter",               bin: "red",         img: "images/Catheter.jpg" },
        { name: "Dialysis Kit",           bin: "red",         img: "images/Dialysis Kit.webp" },
        { name: "Urine Bag",              bin: "red",         img: "images/Urine Bag.webp" },
        { name: "Vacutainers",            bin: "red",         img: "images/Vacutainers.webp" },
        { name: "Human Anatomical Waste", bin: "yellow",      img: "images/Human anatomical waste.webp" },
        { name: "Placenta",               bin: "yellow",      img: "images/Placenta.webp" },
        { name: "Plaster Cast",           bin: "yellow",      img: "images/Plaster cast.jpg" },
        { name: "IV Bottles",             bin: "blue",        img: "images/IV bottles.jpg" },
        { name: "Metallic Body Implants", bin: "blue",        img: "images/Metallic body implants.png" },
        { name: "Lab Slides",             bin: "blue",        img: "images/Lab Slides.jpg" }
    ];

    const trickyItems = [
        { name: "Needles",                bin: "translucent", img: "images/Needles.webp" },
        { name: "Syringe with Needle",    bin: "translucent", img: "images/Syringes with needles.png" },
        { name: "Blade",                  bin: "translucent", img: "images/Blade.webp" },
        { name: "Scalpel",                bin: "translucent", img: "images/Scalpel.webp" },
        { name: "Wound Dressing",         bin: "yellow",      img: "images/Wound dressing.webp" },
        { name: "Scissors",               bin: "red",         img: "images/Scissors.webp" }
    ];

    const allItems      = easyItems.concat(mediumExtraItems);
    const allPlusTricky = allItems.concat(trickyItems);

    // ‚≠ê GAME STATE ‚≠ê
    let score = 0;
    let currentItem = null;
    let timer = 0;
    let timerInterval = null;
    let itemTimeout = null;
    let currentDifficultyKey = null;
    let currentSettings = null;

    // ‚≠ê START GAME WITH SELECTED DIFFICULTY ‚≠ê
    function startGame(difficultyKey) {
        currentDifficultyKey = difficultyKey;
        currentSettings = difficultySettings[difficultyKey];

        // Reset state
        score = 0;
        timer = currentSettings.totalTime;

        // UI changes
        document.getElementById("welcomeScreen").style.display = "none";
        document.getElementById("gameOverScreen").style.display = "none";
        document.getElementById("gameScreen").style.display = "block";

        document.getElementById("scoreDisplay").innerText = "Score: 0";
        document.getElementById("timerDisplay").innerText = "Time Left: " + timer + "s";
        document.getElementById("difficultyDisplay").innerText = currentSettings.label;

        // Start timer and game
        startTimer();
        loadNextItem();
    }

    // ‚≠ê TIMER LOGIC ‚≠ê
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timer--;
            document.getElementById("timerDisplay").innerText = "Time Left: " + timer + "s";

            if (timer <= 0) {
                clearInterval(timerInterval);
                clearTimeout(itemTimeout);
                endGame();
            }
        }, 1000);
    }

    // ‚≠ê DETERMINE ITEM POOL BASED ON DIFFICULTY ‚≠ê
    function getCurrentItemPool() {
        if (currentSettings.itemPool === "easy") {
            return easyItems;
        } else if (currentSettings.itemPool === "all") {
            return allItems;
        } else if (currentSettings.itemPool === "allPlusTricky") {
            return allPlusTricky;
        } else {
            return allItems; // fallback
        }
    }

    // ‚≠ê LOAD A RANDOM ITEM ‚≠ê
    function loadNextItem() {
        clearTimeout(itemTimeout);

        const pool = getCurrentItemPool();
        currentItem = pool[Math.floor(Math.random() * pool.length)];
        document.getElementById("itemImage").src = currentItem.img;
        document.getElementById("itemImage").alt = currentItem.name;

        // Auto-skip logic for Medium / Hard
        if (currentSettings.autoSkipMs) {
            itemTimeout = setTimeout(() => {
                handleNoResponse();
            }, currentSettings.autoSkipMs);
        }
    }

    // ‚≠ê HANDLE NO RESPONSE IN TIME (FOR MEDIUM & HARD) ‚≠ê
    function handleNoResponse() {
        // Count as wrong attempt
        score--;
        document.getElementById("scoreDisplay").innerText = "Score: " + score;

        sendAnalyticsEvent(currentItem.name, "no_response", currentItem.bin, score);

        // Load next item only if game not over
        if (timer > 0) {
            loadNextItem();
        }
    }

    // ‚≠ê CHECK ANSWER ‚≠ê
    function checkAnswer(selectedBin) {
        if (!currentItem) return;

        clearTimeout(itemTimeout);

        if (selectedBin === currentItem.bin) {
            score++;
        } else {
            score--;
        }

        document.getElementById("scoreDisplay").innerText = "Score: " + score;

        sendAnalyticsEvent(currentItem.name, selectedBin, currentItem.bin, score);

        if (timer > 0) {
            loadNextItem();
        }
    }

    // ‚≠ê END GAME ‚≠ê
    function endGame() {
        clearInterval(timerInterval);
        clearTimeout(itemTimeout);

        document.getElementById("gameScreen").style.display = "none";
        document.getElementById("gameOverScreen").style.display = "block";

        document.getElementById("finalScore").innerText = score;
        document.getElementById("finalDifficultyText").innerText =
            "Difficulty played: " + (currentSettings ? currentSettings.label : "");

        // Final analytics (game over)
        sendAnalyticsEvent("GAME_OVER", null, null, score);
    }

    // ‚≠ê BACK TO WELCOME (CHOOSE LEVEL AGAIN) ‚≠ê
    function backToWelcome() {
        document.getElementById("gameOverScreen").style.display = "none";
        document.getElementById("welcomeScreen").style.display = "block";
    }

    // ‚≠ê ANALYTICS PLACEHOLDER ‚≠ê
    function sendAnalyticsEvent(itemName, chosenBin, correctBin, currentScore) {
        console.log("Analytics event:", {
            difficulty: currentDifficultyKey,
            difficultyLabel: currentSettings ? currentSettings.label : null,
            item: itemName,
            chosen: chosenBin,
            correct: correctBin,
            score: currentScore,
            timestamp: new Date().toISOString()
        });

        // üëâ Here you plug in your GA4 / Sheets / API call
    }
</script>

</body>
</html>
