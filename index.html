<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biomedical Waste Segregation Game</title>

  <!-- ðŸ”¹ GA4 START -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4DQYGRYMM7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4DQYGRYMM7');
  </script>
  <!-- ðŸ”¹ GA4 END -->

  <meta name="author" content="Gokul Krishna T.B">
  <meta name="creator" content="Gokul Krishna T.B â€” Biomedical Waste Game Developer">

  <link rel="stylesheet" href="style.css" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>

<body>

  <!-- Fullscreen -->
  <button id="fullscreenBtn" class="fullscreen-btn">â¤¢</button>

  <div class="app-wrapper">

    <!-- START SCREEN -->
    <div class="left-panel" id="startScreen">
      <h1 class="title">Biomedical Waste Segregation Game</h1>
      <p class="subtitle">Match each biomedical item to the correct bin.</p>

      <h2 class="section-title">Select Difficulty</h2>

      <div class="difficulty-grid">
        <div class="difficulty-card" data-level="easy">
          <h3>Easy</h3><p>90 seconds</p>
        </div>
        <div class="difficulty-card selected" data-level="medium">
          <h3>Medium</h3><p>60 seconds</p>
        </div>
        <div class="difficulty-card" data-level="hard">
          <h3>Hard</h3><p>30 seconds</p>
        </div>
      </div>

      <button id="startGameBtn" class="primary-btn">Start Game</button>
      <button id="analyticsBtn" class="secondary-btn">Training Analytics</button>

      <button id="toggleInstructions" class="secondary-btn">
        â–¼ Show Instructions
      </button>

      <div id="instructionsPanel" class="instructions hidden">
        <h3>How to Play</h3>
        <ul>
          <li>Select the correct bin for the item</li>
          <li>Correct answers increase score</li>
          <li>Wrong answers reduce accuracy</li>
          <li>Game ends when time runs out</li>
        </ul>
      </div>
    </div>

    <!-- GAME PANEL -->
    <div class="right-panel hidden" id="gameContainer">

      <div class="top-bar">
        <div class="timer-box">
          <span class="label">Time</span>
          <span id="timerValue" class="timer-value">01:00</span>
          <div class="timer-progress">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>

        <div class="score-box">
          <span class="label">Score</span>
          <span id="score" class="score-value">0</span>
        </div>
      </div>

      <div class="item-area">
        <div id="itemName" class="item-name">Item</div>
      </div>

      <div id="feedback" class="feedback">
        Choose the correct bin
      </div>

      <div class="bins-row">
        <button class="bin-btn bin-yellow" data-bin="Yellow">Yellow</button>
        <button class="bin-btn bin-red" data-bin="Red">Red</button>
        <button class="bin-btn bin-white" data-bin="White">White</button>
        <button class="bin-btn bin-blue" data-bin="Blue">Blue</button>
        <button class="bin-btn bin-green" data-bin="Green">Green</button>
      </div>

      <div id="gameStats" class="game-stats">
        Correct: 0 | Wrong: 0 | Accuracy: 0%
      </div>

    </div>
  </div>

  <!-- SCORE SUBMISSION MODAL -->
  <div id="scoreSubmitModal" class="modal hidden">
    <div class="modal-content">
      <h2>Submit Your Score</h2>
      <input id="playerNameInput" maxlength="20" placeholder="Your name">
      <p id="nameError" class="error-text hidden">
        Enter 3â€“20 letters only
      </p>
      <button id="submitScoreBtn" class="primary-btn">Submit Score</button>
      <button id="cancelSubmitBtn" class="secondary-btn">Cancel</button>
    </div>
  </div>

  <!-- GAME LOGIC -->
  <script type="module" src="game.js?v=3"></script>

  <!-- UI LOGIC (ORIGINAL) -->
  <script>
    const toggleBtn = document.getElementById("toggleInstructions");
    const instructions = document.getElementById("instructionsPanel");

    toggleBtn?.addEventListener("click", () => {
      instructions.classList.toggle("hidden");
      toggleBtn.innerText = instructions.classList.contains("hidden")
        ? "â–¼ Show Instructions"
        : "â–² Hide Instructions";
    });

    document.getElementById("analyticsBtn")?.addEventListener("click", () => {
      window.location.href = "analytics.html";
    });
  </script>

  <!-- ðŸ”¹ REQUIRED GAME START WIRING -->
  <script>
    let selectedDifficulty = "medium";

    document.querySelectorAll(".difficulty-card").forEach(card => {
      card.addEventListener("click", () => {
        document.querySelectorAll(".difficulty-card")
          .forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        selectedDifficulty = card.dataset.level;
      });
    });

    document.getElementById("startGameBtn")?.addEventListener("click", () => {
      document.getElementById("startScreen").classList.add("hidden");
      document.getElementById("gameContainer").classList.remove("hidden");

      if (window.startGame) {
        window.startGame(selectedDifficulty);
      } else {
        console.error("startGame() not found in game.js");
      }
    });
  </script>

</body>
</html>
