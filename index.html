<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Biomedical Waste Training Game</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f5f7ff;
        text-align: center;
    }

    #welcomeScreen, #instructionsScreen, #gameScreen, #resultScreen {
        display: none;
        padding: 20px;
    }

    .btn {
        padding: 12px;
        font-size: 18px;
        background: #1e5aff;
        color: white;
        border: none;
        border-radius: 10px;
        width: 80%;
        margin-top: 15px;
        cursor: pointer;
    }

    .btn-green {
        background: #25D366;
    }

    .bin {
        width: 130px;
        cursor: pointer;
        margin: 10px;
    }

    #itemImage {
        width: 200px;
        height: 200px;
        background: #e8edff;
        object-fit: contain;
        border-radius: 15px;
        padding: 10px;
        margin-top: 15px;
    }

    #timerBarContainer {
        width: 90%;
        background: #ddd;
        height: 12px;
        border-radius: 10px;
        margin: 10px auto;
    }

    #timerBar {
        height: 12px;
        background: #1e5aff;
        width: 100%;
        border-radius: 10px;
    }

    .footer-credit {
        margin-top: 20px;
        color: #777;
        font-size: 14px;
    }

    #toast {
        display: none;
        position: fixed;
        top: 20px;
        left:50%;
        transform: translateX(-50%);
        background: #ff4444;
        padding: 10px 20px;
        color: white;
        border-radius: 10px;
        font-weight: bold;
    }
</style>

<!-- Confetti Library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</head>
<body>

<div id="toast"></div>

<!-- â­ WELCOME SCREEN -->
<div id="welcomeScreen">
    <h1>Biomedical Waste Training Game</h1>
    <p>Fast, interactive BMW segregation training for healthcare staff.</p>
    <button class="btn" onclick="showScreen('instructionsScreen')">Continue</button>

    <p class="footer-credit">Designed & Developed by <b>Gokul T.B.</b></p>
</div>

<!-- â­ INSTRUCTIONS SCREEN -->
<div id="instructionsScreen">
    <h2>Instructions</h2>
    <p>â€¢ An item will appear on screen.</p>
    <p>â€¢ Tap the correct waste bin as fast as possible.</p>
    <p>â€¢ Correct answer = +1</p>
    <p>â€¢ Wrong answer = -1</p>
    <p>â€¢ Medium & Hard modes auto-skip after a few seconds.</p>

    <button class="btn" onclick="showScreen('difficultyScreen')">Next</button>
</div>

<!-- â­ DIFFICULTY SCREEN -->
<div id="difficultyScreen">
    <h2>Select Difficulty</h2>
    <button class="btn" onclick="startGame('easy')">Easy (90 sec)</button>
    <button class="btn" onclick="startGame('medium')">Medium (60 sec)</button>
    <button class="btn" onclick="startGame('hard')">Hard (30 sec)</button>
</div>

<!-- â­ GAME SCREEN -->
<div id="gameScreen">
    <h2 id="difficultyDisplay"></h2>

    <div id="timerBarContainer"><div id="timerBar"></div></div>

    <h3>Score: <span id="scoreDisplay">0</span></h3>

    <h3 id="itemName"></h3>
    <img id="itemImage">

    <div>
        <img class="bin" src="images/redbin.jpg" onclick="checkAnswer('red')">
        <img class="bin" src="images/yellowbin.jpg" onclick="checkAnswer('yellow')">
        <img class="bin" src="images/bluebin.png" onclick="checkAnswer('blue')">
        <img class="bin" src="images/greenbin.png" onclick="checkAnswer('green')">
        <img class="bin" src="images/translucentbin.png" onclick="checkAnswer('translucent')">
    </div>
</div>

<!-- â­ RESULT SCREEN -->
<div id="resultScreen">
    <h1>ðŸŽ‰ Training Complete!</h1>
    <h2>Your Score: <span id="finalScore"></span></h2>
    <h3 id="finalDifficultyText"></h3>

    <button class="btn" onclick="showScreen('welcomeScreen')">Play Again</button>

    <!-- WhatsApp Share -->
    <button class="btn btn-green" onclick="shareOnWhatsApp()">Share Score on WhatsApp</button>

    <p class="footer-credit">Designed & Developed by <b>Gokul T.B.</b></p>
</div>

<script>
/* ------------------------------
   SCREEN SWITCHING
------------------------------ */
function showScreen(id) {
    ["welcomeScreen", "instructionsScreen", "difficultyScreen", "gameScreen", "resultScreen"]
        .forEach(s => document.getElementById(s).style.display = "none");

    document.getElementById(id).style.display = "block";
}

/* ------------------------------
   SETTINGS
------------------------------ */
const settings = {
    easy:   { time: 90, skip: null, label: "Easy Mode" },
    medium: { time: 60, skip: 5000, label: "Medium Mode" },
    hard:   { time: 30, skip: 3000, label: "Hard Mode" }
};

/* ------------------------------
   ITEMS
------------------------------ */
const easyItems = [
    {name:"Mask", img:"images/Mask.webp", bin:"red"},
    {name:"Blood Bag", img:"images/Blood Bag.avif", bin:"yellow"},
    {name:"Vial", img:"images/Vial.jpg", bin:"blue"},
    {name:"Expired Medicines", img:"images/Expired Medicines.webp", bin:"green"}
];

const mediumExtra = [
    {name:"IV Set", img:"images/IV SET.png", bin:"red"},
    {name:"Lab Slides", img:"images/Lab Slides.jpg", bin:"blue"},
    {name:"Anatomical Waste", img:"images/Human anatomical waste.webp", bin:"yellow"}
];

const risky = [
    {name:"Needles", img:"images/Needles.webp", bin:"translucent"},
    {name:"Blade", img:"images/Blade.webp", bin:"translucent"},
];

const allItems = easyItems.concat(mediumExtra);
const hardItems = allItems.concat(risky);

/* ------------------------------
   GAME STATE
------------------------------ */
let score = 0, timer = 0, currentItem = null, activeSkip = null, timerInterval = null;

/* ------------------------------
   START GAME
------------------------------ */
function startGame(level) {

    showScreen("gameScreen");

    score = 0;
    timer = settings[level].time;

    document.getElementById("difficultyDisplay").innerText = settings[level].label;
    document.getElementById("scoreDisplay").innerText = score;

    startTimer();

    loadNextItem(level);
}

/* ------------------------------
   TIMER
------------------------------ */
function startTimer() {

    timerInterval = setInterval(() => {
        timer--;

        const percent = (timer /  settings[level].time) * 100;
        document.getElementById("timerBar").style.width = percent + "%";

        if (timer <= 0) endGame();
    }, 1000);
}

/* ------------------------------
   LOAD NEXT ITEM
------------------------------ */
function loadNextItem(level) {

    clearTimeout(activeSkip);

    let pool = (level === "easy") ? easyItems :
               (level === "medium") ? allItems : hardItems;

    currentItem = pool[Math.floor(Math.random() * pool.length)];

    document.getElementById("itemImage").src = currentItem.img;
    document.getElementById("itemName").innerText = "Item: " + currentItem.name;

    if (settings[level].skip) {
        activeSkip = setTimeout(() => {
            score--;
            document.getElementById("scoreDisplay").innerText = score;
            showToast("â± Auto-skip! -1");
            loadNextItem(level);
        }, settings[level].skip);
    }
}

/* ------------------------------
   CHECK ANSWER
------------------------------ */
function checkAnswer(bin) {
    clearTimeout(activeSkip);

    if (bin === currentItem.bin) {
        score++;
        showToast("âœ” Correct! +1");
    } else {
        score--;
        showToast("âŒ Wrong! Correct bin: " + currentItem.bin.toUpperCase());
    }

    document.getElementById("scoreDisplay").innerText = score;

    if (timer > 0) loadNextItem(currentSettings);
}

/* ------------------------------
   GAME OVER + CONFETTI
------------------------------ */
function endGame() {

    clearInterval(timerInterval);
    clearTimeout(activeSkip);

    document.getElementById("finalScore").innerText = score;
    document.getElementById("finalDifficultyText").innerText = settings[level].label;

    showScreen("resultScreen");

    // Minimal confetti
    confetti({
        particleCount: 100,
        spread: 50,
        origin: { y: 0.2 }
    });
}

/* ------------------------------
   WHATSAPP SHARE (W2 FORMAT)
------------------------------ */
function shareOnWhatsApp() {

    const difficulty = document.getElementById("finalDifficultyText").innerText;
    const finalScore = document.getElementById("finalScore").innerText;

    const msg =
        "I scored " + finalScore + " points on " + difficulty +
        " in the Biomedical Waste Training Game!\nTry it here: https://creator619-python.github.io/Biomedical-Waste-Game/";

    window.open("https://wa.me/?text=" + encodeURIComponent(msg), "_blank");
}

/* ------------------------------
   TOAST FEEDBACK
------------------------------ */
function showToast(msg) {
    const t = document.getElementById("toast");
    t.style.display = "block";
    t.innerText = msg;
    setTimeout(() => t.style.display = "none", 1300);
}
</script>

<script>
window.onload = () => showScreen("welcomeScreen");
</script>

</body>
</html>
