// analytics.js — ES MODULE (Firebase v10 compatible)

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

import Chart from "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";

/* =====================================================
   FIREBASE CONFIG — MUST MATCH game.js
===================================================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* =====================================================
   LOAD DATA + RENDER CHART
===================================================== */
async function loadAnalytics() {
  const snapshot = await getDocs(collection(db, "scores"));

  if (snapshot.empty) {
    console.warn("No analytics data available");
    return;
  }

  const labels = [];
  const scores = [];

  snapshot.forEach(doc => {
    const data = doc.data();
    labels.push(data.name);
    scores.push(data.score);
  });

  const ctx = document.getElementById("scoreChart");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "Score",
        data: scores
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

loadAnalytics();
